#!/usr/bin/env bash
set -e

SCHEME="base16-$1"
BG="${2:-dark}"
REPO="$HOME/.colorschemes/"

[[ -d $REPO ]] || (
    echo "$REPO not found. Run install/base16colors."
    exit 1
)

[[ -e "$REPO/shell/${SCHEME}.${BG}.sh" ]] || (
    echo "color scheme $SCHEME not found."
    exit 1
)


################################################################################
# Shell                                                                        #
################################################################################
echo "/bin/sh \"$REPO/shell/${SCHEME}.${BG}.sh\"" > .zsh/base16colors.zsh


################################################################################
# Vim                                                                          #
################################################################################
cat > "$HOME/.vim/plugin/base16colors.vim" <<EOF
colorscheme $SCHEME
set bg=$BG
EOF


################################################################################
# Xresources                                                                   #
################################################################################
XRES_COLOR="$HOME/.Xresources.d/base16colors.xresources"
[[ -h "$XRES_COLOR" ]] && rm "$XRES_COLOR"
ln -s "$REPO/xresources/$SCHEME.${BG}.256.xresources" "$XRES_COLOR"
xrdb -DBASE16 "$HOME/.Xresources"


################################################################################
# Apply color scheme for current session                                       #
################################################################################
/bin/sh "$REPO/shell/${SCHEME}.${BG}.sh"
